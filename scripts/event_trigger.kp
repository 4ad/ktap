#!/usr/bin/env ktap

soft_disabled = 1
this_cpu = 0

trace "syscalls:sys_enter_open" function (e) {
	print(e)
	soft_disabled = 0
	this_cpu = cpu()
}

trace "*:*" function (e) {
	if (soft_disabled == 0 && cpu() == this_cpu) {
		print(e)
	}
}

trace "syscalls:sys_exit_open" function (e) {
	print(e)
	if (cpu() == this_cpu) {
		exit()
	}
}

